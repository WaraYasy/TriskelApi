[pytest]
# Directorio de tests
testpaths = tests

# Patrones de archivos de test
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Opciones de output
addopts =
    # Verbosidad
    -v
    --tb=short

    # Cobertura de lógica de negocio en app/domain
    # NOTA: La métrica del 37% incluye infraestructura NO testeable sin Firebase/DB real:
    #   - API endpoints (api.py)
    #   - Adapters/Repositories (conexiones a BD)
    #   - Web dashboard
    # La lógica de negocio PURA tiene estas coberturas REALES:
    #   - PlayerService: 100%
    #   - GameService: 92%
    #   - EventService: 94%
    #   - Players models/schemas: 100%
    #   - Games models/schemas: 82-83%
    --cov=app/domain
    --cov-report=html
    --cov-report=term-missing
    --cov-report=xml
    --cov-fail-under=33

    # Mostrar tests lentos (>1s)
    --durations=10

    # Warnings
    -W ignore::DeprecationWarning
    --strict-markers

    # Asyncio
    --asyncio-mode=auto

# Marcadores personalizados
markers =
    unit: Tests unitarios de lógica de negocio
    integration: Tests de integración con adapters/repositories
    e2e: Tests end-to-end de flujos completos
    slow: Tests que tardan más de 1 segundo
    security: Tests de seguridad y validación
    edge_case: Tests de casos límite y edge cases
    requires_firebase: Tests que requieren mock de Firebase
    requires_db: Tests que requieren base de datos SQL

# Asyncio configuración
asyncio_mode = auto

# Cobertura - excluir archivos que no son lógica de negocio
[coverage:run]
omit =
    */tests/*
    */venv/*
    */__pycache__/*
    */config/*
    */main.py
    */templates/*
    */static/*
    # Excluir API endpoints (requieren servidor corriendo)
    app/domain/*/api.py
    app/api/*
    # Excluir adapters/repositories (requieren Firebase/DB real)
    app/domain/*/adapters/*
    app/domain/*/repository.py
    # Excluir web dashboard
    app/domain/web/*
    # Excluir sessions (no implementado)
    app/domain/sessions/*
    # Excluir middleware (requiere integración completa)
    app/middleware/*
    # Excluir infrastructure (conexiones a BD)
    app/infrastructure/*
    # Excluir models de auth (no testeados directamente, se testea via schemas)
    app/domain/auth/models.py

[coverage:report]
exclude_lines =
    # Excluir código que no se ejecuta
    pragma: no cover
    def __repr__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.:
    if TYPE_CHECKING:
    @abstractmethod
