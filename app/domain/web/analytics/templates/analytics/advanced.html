<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Métricas Avanzadas - Triskel Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard-admin.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/public.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/theme.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
</head>

<body class="dashboard-body">
    <!-- Theme Toggle Button -->
    <button class="theme-toggle" onclick="toggleTheme()" title="Cambiar tema" aria-label="Cambiar tema claro/oscuro">
        <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" />
        </svg>
        <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="5" />
            <line x1="12" y1="1" x2="12" y2="3" />
            <line x1="12" y1="21" x2="12" y2="23" />
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
            <line x1="1" y1="12" x2="3" y2="12" />
            <line x1="21" y1="12" x2="23" y2="12" />
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
        </svg>
    </button>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-brand">
                <span class="brand-icon">✦</span>
                <div class="brand-text">
                    <span class="brand-company">Mandrágora</span>
                    <span class="brand-role">Triskel</span>
                </div>
            </div>
        </div>

        <nav class="sidebar-nav">
            <a href="/web/" class="nav-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
                        stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                <span>Inicio</span>
            </a>
            <a href="/web/dashboard" class="nav-item">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <rect x="3" y="3" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5" />
                    <rect x="11" y="3" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5" />
                    <rect x="3" y="11" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5" />
                    <rect x="11" y="11" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5" />
                </svg>
                <span>Analytics</span>
            </a>
            <a href="/web/dashboard/players" class="nav-item">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <circle cx="10" cy="7" r="3" stroke="currentColor" stroke-width="1.5" />
                    <path d="M16 17a6 6 0 10-12 0" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                </svg>
                <span>Jugadores</span>
            </a>
            <a href="/web/dashboard/games" class="nav-item">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <rect x="2" y="6" width="16" height="10" rx="2" stroke="currentColor" stroke-width="1.5" />
                    <path d="M6 9v4M4 11h4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                    <circle cx="13" cy="10" r="1" fill="currentColor" />
                    <circle cx="15" cy="12" r="1" fill="currentColor" />
                </svg>
                <span>Partidas</span>
            </a>
            <a href="/web/dashboard/choices" class="nav-item">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M10 3v14M6 6l8 0M4 9l4-3v6l-4-3zM16 9l-4-3v6l4-3z" stroke="currentColor" stroke-width="1.5"
                        stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                <span>Decisiones</span>
            </a>
            <a href="/web/dashboard/events" class="nav-item">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M3 10h4l3-6 4 12 3-6h3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
                <span>Eventos</span>
            </a>
            <a href="/web/dashboard/advanced" class="nav-item active">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M3 17V10M7 17V7M11 17V12M15 17V5M19 17V8" stroke="currentColor" stroke-width="1.5"
                        stroke-linecap="round" />
                </svg>
                <span>Avanzado</span>
            </a>
            <a href="/docs" target="_blank" class="nav-item">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <rect x="4" y="2" width="12" height="16" rx="1" stroke="currentColor" stroke-width="1.5" />
                    <path d="M7 6h6M7 10h6M7 14h4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                </svg>
                <span>API Docs</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <a href="/web/admin/login" class="btn-admin-access">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"
                        stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                <span>Acceso Admin</span>
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Top Bar -->
        <header class="top-bar">
            <div class="top-bar-left">
                <h1 class="page-title">Métricas Avanzadas</h1>
                <p class="page-subtitle">Análisis detallado de gameplay y progresión</p>
            </div>
        </header>

        <!-- Stats Grid -->
        <section class="stats-section">
            <div class="stat-card-admin">
                <div class="stat-header">
                    <span class="stat-title">Muertes Totales</span>
                </div>
                <div class="stat-body">
                    <div class="stat-number">{{ metrics.total_deaths }}</div>
                    <div class="stat-meta">En todas las partidas</div>
                </div>
            </div>

            <div class="stat-card-admin">
                <div class="stat-header">
                    <span class="stat-title">Reliquias</span>
                </div>
                <div class="stat-body">
                    <div class="stat-number">{{ metrics.total_relics }}</div>
                    <div class="stat-meta">Reliquias obtenidas</div>
                </div>
            </div>

            <div class="stat-card-admin highlight">
                <div class="stat-header">
                    <span class="stat-title">Completado</span>
                </div>
                <div class="stat-body">
                    <div class="stat-number-large">{{ metrics.avg_completion_percentage }}%</div>
                    <div class="stat-meta">Promedio de progreso</div>
                </div>
            </div>

            <div class="stat-card-admin">
                <div class="stat-header">
                    <span class="stat-title">Partidas</span>
                </div>
                <div class="stat-body">
                    <div class="stat-number">{{ metrics.total_games }}</div>
                    <div class="stat-meta">Total analizadas</div>
                </div>
            </div>
        </section>

        <!-- Charts Section -->
        <section class="charts-section">
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">Distribución de Reliquias</h3>
                </div>
                <div class="chart-body">
                    {{ relics_chart|safe }}
                </div>
            </div>

            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">Tasa de Completado por Nivel</h3>
                </div>
                <div class="chart-body">
                    {{ completion_chart|safe }}
                </div>
            </div>
        </section>

        <section class="charts-section">
            <div class="chart-card large">
                <div class="chart-header">
                    <h3 class="chart-title">Tiempo Promedio por Nivel</h3>
                </div>
                <div class="chart-body">
                    {{ playtime_chart|safe }}
                </div>
            </div>
        </section>

        <!-- Games Table -->
        <section class="events-section">
            <div class="section-header">
                <h2 class="section-title">Partidas Recientes</h2>
            </div>
            <div class="events-table">
                <table>
                    <thead>
                        <tr>
                            <th>GAME ID</th>
                            <th>JUGADOR</th>
                            <th>ESTADO</th>
                            <th>COMPLETADO</th>
                            <th>MUERTES</th>
                            <th>RELIQUIAS</th>
                            <th>INICIO</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for game in games[:20] %}
                        <tr>
                            <td style="font-family: monospace;">{{ game.game_id[:8] }}...</td>
                            <td>{{ game.player_id[:8] }}...</td>
                            <td>
                                {% if game.status == 'completed' %}
                                <span class="event-status completed">completado</span>
                                {% elif game.status == 'in_progress' %}
                                <span class="event-status started">en progreso</span>
                                {% else %}
                                <span class="event-status event">{{ game.status }}</span>
                                {% endif %}
                            </td>
                            <td>{{ game.completion_percentage|round(1) }}%</td>
                            <td>{{ game.metrics.total_deaths }}</td>
                            <td>
                                {% if game.relics %}
                                {{ game.relics|join(', ') }}
                                {% else %}
                                <span style="color: #6b7280;">-</span>
                                {% endif %}
                            </td>
                            <td style="color: #9ca3af;">{{ game.started_at }}</td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="7" style="text-align: center; color: #9ca3af; padding: 2rem;">
                                No hay partidas disponibles
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Footer -->
        <footer class="main-footer">
            <p>Triskel Analytics - Métricas Avanzadas © 2026 - Mandrágora</p>
        </footer>
    </main>

    <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
    <script src="{{ url_for('static', filename='js/sidebar.js') }}"></script>
</body>

</html>