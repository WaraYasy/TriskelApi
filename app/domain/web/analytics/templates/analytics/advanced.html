<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√©tricas Avanzadas - Triskel Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/analytics.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
</head>

<body style="background: #0a0e1a; font-family: 'Inter', sans-serif; margin: 0; padding: 0;">
    <div class="analytics-container">
        <!-- Header -->
        <div class="analytics-header">
            <h2>üìà M√©tricas Avanzadas</h2>
            <p>An√°lisis detallado de gameplay y progresi√≥n</p>
        </div>

        <!-- Navegaci√≥n -->
        <div class="analytics-nav" style="margin-bottom: 2rem;">
            <a href="{{ url_for('analytics.index') }}" class="btn">
                <span>‚Üê</span> Volver al Dashboard Principal
            </a>
        </div>

        <!-- M√©tricas destacadas -->
        <div class="stats-row">
            <div class="stat-card-analytics">
                <h5><i>üíÄ</i> Muertes Totales</h5>
                <h2>{{ metrics.total_deaths }}</h2>
                <small>En todas las partidas</small>
            </div>

            <div class="stat-card-analytics">
                <h5><i>üè∫</i> Reliquias</h5>
                <h2>{{ metrics.total_relics }}</h2>
                <small>Reliquias obtenidas</small>
            </div>

            <div class="stat-card-analytics">
                <h5><i>üìä</i> Completado</h5>
                <h2>{{ metrics.avg_completion_percentage }}%</h2>
                <small>Promedio de progreso</small>
            </div>

            <div class="stat-card-analytics">
                <h5><i>üéÆ</i> Partidas</h5>
                <h2>{{ metrics.total_games }}</h2>
                <small>Total analizadas</small>
            </div>
        </div>

        <!-- Gr√°ficos -->
        <div class="chart-container">
            <div class="chart-card-analytics">
                <div class="card-header">
                    <h5><i>üè∫</i> Distribuci√≥n de Reliquias</h5>
                </div>
                <div class="card-body">
                    {{ relics_chart|safe }}
                </div>
            </div>

            <div class="chart-card-analytics">
                <div class="card-header">
                    <h5><i>üìä</i> Tasa de Completado por Nivel</h5>
                </div>
                <div class="card-body">
                    {{ completion_chart|safe }}
                </div>
            </div>
        </div>

        <!-- Gr√°fico de Tiempo por Nivel -->
        <div class="chart-container">
            <div class="chart-card-analytics chart-full">
                <div class="card-header">
                    <h5><i>‚è±Ô∏è</i> Tiempo Promedio por Nivel</h5>
                </div>
                <div class="card-body">
                    {{ playtime_chart|safe }}
                </div>
            </div>
        </div>

        <!-- Tabla de partidas recientes -->
        <div class="chart-card-analytics" style="margin-top: 2rem;">
            <div class="card-header">
                <h5><i>üìã</i> Partidas Recientes</h5>
            </div>
            <div class="card-body">
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 1px solid #2d3748;">
                                <th
                                    style="padding: 1rem; text-align: left; color: #a0aec0; font-size: 0.875rem; font-weight: 600;">
                                    Game ID</th>
                                <th
                                    style="padding: 1rem; text-align: left; color: #a0aec0; font-size: 0.875rem; font-weight: 600;">
                                    Jugador</th>
                                <th
                                    style="padding: 1rem; text-align: left; color: #a0aec0; font-size: 0.875rem; font-weight: 600;">
                                    Estado</th>
                                <th
                                    style="padding: 1rem; text-align: left; color: #a0aec0; font-size: 0.875rem; font-weight: 600;">
                                    Completado</th>
                                <th
                                    style="padding: 1rem; text-align: left; color: #a0aec0; font-size: 0.875rem; font-weight: 600;">
                                    Muertes</th>
                                <th
                                    style="padding: 1rem; text-align: left; color: #a0aec0; font-size: 0.875rem; font-weight: 600;">
                                    Reliquias</th>
                                <th
                                    style="padding: 1rem; text-align: left; color: #a0aec0; font-size: 0.875rem; font-weight: 600;">
                                    Inicio</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for game in games[:20] %}
                            <tr style="border-bottom: 1px solid #2d3748;">
                                <td style="padding: 1rem; color: #ffffff; font-family: monospace; font-size: 0.875rem;">
                                    {{ game.game_id[:8] }}...</td>
                                <td style="padding: 1rem; color: #ffffff; font-size: 0.875rem;">{{ game.player_id[:8]
                                    }}...</td>
                                <td style="padding: 1rem;">
                                    {% if game.status == 'completed' %}
                                    <span
                                        style="background: #10b981; color: #ffffff; padding: 0.25rem 0.75rem; border-radius: 0.375rem; font-size: 0.75rem; font-weight: 600;">Completado</span>
                                    {% elif game.status == 'in_progress' %}
                                    <span
                                        style="background: #3b82f6; color: #ffffff; padding: 0.25rem 0.75rem; border-radius: 0.375rem; font-size: 0.75rem; font-weight: 600;">En
                                        progreso</span>
                                    {% else %}
                                    <span
                                        style="background: #6b7280; color: #ffffff; padding: 0.25rem 0.75rem; border-radius: 0.375rem; font-size: 0.75rem; font-weight: 600;">{{
                                        game.status }}</span>
                                    {% endif %}
                                </td>
                                <td style="padding: 1rem; color: #ffffff; font-size: 0.875rem;">{{
                                    game.completion_percentage|round(1) }}%</td>
                                <td style="padding: 1rem; color: #ffffff; font-size: 0.875rem;">{{
                                    game.metrics.total_deaths }}</td>
                                <td style="padding: 1rem; color: #ffffff; font-size: 0.875rem;">
                                    {% if game.relics %}
                                    {{ game.relics|join(', ') }}
                                    {% else %}
                                    <span style="color: #718096;">Ninguna</span>
                                    {% endif %}
                                </td>
                                <td style="padding: 1rem; color: #a0aec0; font-size: 0.875rem;">{{ game.started_at }}
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="7" style="padding: 2rem; text-align: center; color: #718096;">No hay
                                    partidas disponibles</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configurar tema oscuro para todos los gr√°ficos de Plotly
        document.addEventListener('DOMContentLoaded', function () {
            const plots = document.querySelectorAll('.plotly');
            plots.forEach(plot => {
                if (plot && plot.layout) {
                    Plotly.relayout(plot, {
                        paper_bgcolor: 'transparent',
                        plot_bgcolor: 'transparent',
                        font: { color: '#a0aec0' },
                        xaxis: { gridcolor: '#2d3748', color: '#a0aec0' },
                        yaxis: { gridcolor: '#2d3748', color: '#a0aec0' }
                    });
                }
            });
        });
    </script>
</body>

</html>