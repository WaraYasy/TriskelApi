<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics - Triskel Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/analytics.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
</head>

<body style="background: #0a0e1a; font-family: 'Inter', sans-serif; margin: 0; padding: 0;">
    <div class="analytics-container">
        <!-- Header -->
        <div class="analytics-header">
            <h2>ğŸ“Š Analytics Dashboard</h2>
            <p>MÃ©tricas y visualizaciones del juego en tiempo real</p>
        </div>

        <!-- MÃ©tricas globales - Primera fila -->
        <div class="stats-row">
            <div class="stat-card-analytics">
                <h5><i>ğŸ‘¥</i> Jugadores</h5>
                <h2>{{ metrics.total_players }}</h2>
                <small>Total registrados</small>
            </div>

            <div class="stat-card-analytics">
                <h5><i>ğŸ®</i> Partidas</h5>
                <h2>{{ metrics.total_games }}</h2>
                <small>Total jugadas</small>
            </div>

            <div class="stat-card-analytics">
                <h5><i>â±ï¸</i> Tiempo Promedio</h5>
                <h2>{{ "%.1f"|format(metrics.avg_playtime / 3600) }}h</h2>
                <small>Por partida</small>
            </div>

            <div class="stat-card-analytics">
                <h5><i>ğŸ†</i> Completado</h5>
                <h2>{{ metrics.completion_rate }}%</h2>
                <small>Tasa de completado</small>
            </div>
        </div>

        <!-- Segunda fila de mÃ©tricas -->
        <div class="stats-row">
            <div class="stat-card-analytics">
                <h5><i>ğŸ’€</i> Muertes</h5>
                <h2>{{ metrics.total_deaths }}</h2>
                <small>Total en el juego</small>
            </div>

            <div class="stat-card-analytics">
                <h5><i>âš¡</i> Eventos</h5>
                <h2>{{ metrics.total_events }}</h2>
                <small>Eventos registrados</small>
            </div>

            <div class="stat-card-analytics">
                <h5><i>ğŸ’”</i> Muertes/Partida</h5>
                <h2>{{ "%.1f"|format(metrics.avg_deaths) }}</h2>
                <small>Promedio</small>
            </div>

            <div class="stat-card-analytics">
                <h5><i>âœ…</i> Completadas</h5>
                <h2>{{ metrics.completed_games }}</h2>
                <small>Partidas terminadas</small>
            </div>
        </div>

        <!-- NavegaciÃ³n de secciones -->
        <div class="analytics-nav">
            <a href="{{ url_for('analytics.players') }}" class="btn">
                <span>ğŸ‘¥</span> AnÃ¡lisis de Jugadores
            </a>
            <a href="{{ url_for('analytics.games') }}" class="btn">
                <span>ğŸ®</span> AnÃ¡lisis de Partidas
            </a>
            <a href="{{ url_for('analytics.choices') }}" class="btn">
                <span>âš–ï¸</span> Decisiones Morales
            </a>
            <a href="{{ url_for('analytics.events') }}" class="btn">
                <span>âš¡</span> Eventos
            </a>
            <a href="{{ url_for('analytics.advanced') }}" class="btn">
                <span>ğŸ“ˆ</span> MÃ©tricas Avanzadas
            </a>
            <a href="{{ url_for('analytics.export') }}?type=players&format=csv" class="btn">
                <span>ğŸ’¾</span> Exportar Datos
            </a>
            <a href="/web/" class="btn">
                <span>ğŸ </span> Volver al Inicio
            </a>
        </div>

        <!-- GrÃ¡ficos -->
        <div class="chart-container">
            <div class="chart-card-analytics">
                <div class="card-header">
                    <h5><i>ğŸ“Š</i> DistribuciÃ³n de Decisiones Morales</h5>
                </div>
                <div class="card-body">
                    {{ moral_chart|safe }}
                </div>
            </div>

            <div class="chart-card-analytics">
                <div class="card-header">
                    <h5><i>ğŸ¯</i> AlineaciÃ³n Moral de Jugadores</h5>
                </div>
                <div class="card-body">
                    {{ alignment_chart|safe }}
                </div>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-card-analytics chart-full">
                <div class="card-header">
                    <h5><i>ğŸ’€</i> Muertes por Nivel</h5>
                </div>
                <div class="card-body">
                    {{ deaths_chart|safe }}
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configurar tema oscuro para todos los grÃ¡ficos de Plotly
        document.addEventListener('DOMContentLoaded', function () {
            const plots = document.querySelectorAll('.plotly');
            plots.forEach(plot => {
                if (plot && plot.layout) {
                    Plotly.relayout(plot, {
                        paper_bgcolor: 'transparent',
                        plot_bgcolor: 'transparent',
                        font: { color: '#a0aec0' },
                        xaxis: { gridcolor: '#2d3748', color: '#a0aec0' },
                        yaxis: { gridcolor: '#2d3748', color: '#a0aec0' }
                    });
                }
            });
        });
    </script>
</body>

</html>