{% extends "analytics/base_dashboard.html" %}

{% block title %}Decisiones - Triskel Dashboard{% endblock %}
{% block nav_choices %}active{% endblock %}

{% block content %}
<!-- Top Bar -->
<header class="top-bar">
    <div class="top-bar-left">
        <h1 class="page-title">Decisiones Morales</h1>
        <p class="page-subtitle">Análisis de elecciones y alineación moral</p>
    </div>
</header>

<!-- Charts Grid -->
<section class="charts-section" style="grid-template-columns: repeat(2, 1fr);">
    <!-- Global Good vs Bad -->
    <div class="chart-card">
        <div class="chart-header">
            <h3 class="chart-title">Distribución de Decisiones Morales</h3>
        </div>
        <div class="chart-body" id="chart-global">
            <div class="chart-loader">
                <div class="loader-spinner"></div>
                <span>Cargando gráfico...</span>
            </div>
        </div>
    </div>

    <!-- Moral Alignment -->
    <div class="chart-card">
        <div class="chart-header">
            <h3 class="chart-title">Alineamiento Moral de Jugadores</h3>
        </div>
        <div class="chart-body" id="chart-alignment">
            <div class="chart-loader">
                <div class="loader-spinner"></div>
                <span>Cargando gráfico...</span>
            </div>
        </div>
    </div>

    <!-- Choices by Level (Full Width) -->
    <div class="chart-card" style="grid-column: span 2;">
        <div class="chart-header">
            <h3 class="chart-title">Decisiones por Nivel</h3>
        </div>
        <div class="chart-body" id="chart-levels">
            <div class="chart-loader">
                <div class="loader-spinner"></div>
                <span>Cargando gráfico...</span>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block footer_text %}Triskel Analytics - Decisiones © 2026 - Mandrágora{% endblock %}

{% block extra_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        loadDashboard();
    });

    async function loadDashboard() {
        loadChart('/web/dashboard/api/charts/choices/global', 'chart-global');
        loadChart('/web/dashboard/api/charts/choices/alignment', 'chart-alignment');
        loadChart('/web/dashboard/api/charts/choices/levels', 'chart-levels');
    }

    async function loadChart(url, containerId) {
        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error('Error network');
            const data = await response.json();
            document.getElementById(containerId).innerHTML = data.html;
        } catch (error) {
            console.error("Error loading chart:", error);
            document.getElementById(containerId).innerHTML =
                '<div class="chart-loader"><span>Error al cargar datos</span></div>';
        }
    }
</script>
{% endblock %}
